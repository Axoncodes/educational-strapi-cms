(self.webpackChunkcms=self.webpackChunkcms||[]).push([[8155],{97259:(v,w,a)=>{"use strict";a.r(w),a.d(w,{default:()=>Ve});var e=a(67294),g=a(17034),d=a(185),y=a(53979),S=a(29728),se=a(49066),le=a(77197),k=a(79107),ie=a(85018),T=a(41054),U=a(86896),ce=a(88767),$=a(86706),de=a(27887);function ue(t,o){const r=(0,$.oR)();(0,e.useEffect)(()=>{r.injectReducer(t,o)},[r,t,o])}var c=a(53616);function ge({status:t,data:o}){return{type:c.QM,payload:{status:t,workflows:o}}}function me(t){return{type:c.x4,payload:{stageId:t}}}function fe(t={}){return{type:c.Ot,payload:t}}function X(t,o){return{type:c.Nj,payload:{stageId:t,...o}}}function pe(t,o){return{type:c.$k,payload:{newIndex:o,oldIndex:t}}}var E=a(11047),N=a(75515),he=a(12645),ve=a(45697),m=a.n(ve),A=a(88972);const we=(0,A.ZP)(E.k)`
  svg path {
    fill: ${({theme:t})=>t.colors.neutral600};
  }
`;function Y({name:t}){return e.createElement(E.k,{background:"primary100",borderStyle:"dashed",borderColor:"primary600",borderWidth:"1px",gap:3,hasRadius:!0,padding:3,shadow:"tableShadow",width:(0,k.Q1)(300)},e.createElement(we,{alignItems:"center",background:"neutral200",borderRadius:"50%",height:6,justifyContent:"center",width:6},e.createElement(he.Z,{width:`${8/16}rem`})),e.createElement(N.Z,{fontWeight:"bold"},t))}Y.propTypes={name:m().string.isRequired};var C=a(41580),Se=a(99782);const G=(0,A.ZP)(Se.Z)`
  > circle {
    fill: ${({theme:t})=>t.colors.neutral150};
  }
  > path {
    fill: ${({theme:t})=>t.colors.neutral600};
  }
`,ye=(0,A.ZP)(C.x)`
  border-radius: 26px;

  svg {
    height: ${({theme:t})=>t.spaces[6]};
    width: ${({theme:t})=>t.spaces[6]};

    > path {
      fill: ${({theme:t})=>t.colors.neutral600};
    }
  }

  &:hover {
    color: ${({theme:t})=>t.colors.primary600} !important;
    ${N.Z} {
      color: ${({theme:t})=>t.colors.primary600} !important;
    }

    ${G} {
      > circle {
        fill: ${({theme:t})=>t.colors.primary600};
      }
      > path {
        fill: ${({theme:t})=>t.colors.neutral100};
      }
    }
  }

  &:active {
    ${N.Z} {
      color: ${({theme:t})=>t.colors.primary600};
    }

    ${G} {
      > circle {
        fill: ${({theme:t})=>t.colors.primary600};
      }
      > path {
        fill: ${({theme:t})=>t.colors.neutral100};
      }
    }
  }
`;function J({children:t,...o}){return e.createElement(ye,{as:"button",background:"neutral0",border:"neutral150",paddingBottom:3,paddingLeft:4,paddingRight:4,paddingTop:3,shadow:"filterShadow",...o},e.createElement(E.k,{gap:2},e.createElement(G,{"aria-hidden":!0}),e.createElement(N.Z,{variant:"pi",fontWeight:"bold",textColor:"neutral500"},t)))}J.propTypes={children:m().node.isRequired};var ke=a(63237),Ee=a(48734),xe=a(74756),q=a(12028),Me=a(63081),be=a(11276),_=a(67819),Ce=a(16364),ee=a(70642),We=a(20022),De=a(12814),Re=a(61080),Ie=a(75642),Ze=a(13920),V=a(13037);const Te=(0,V.s)();function $e(){return e.createElement(C.x,{background:"primary100",borderStyle:"dashed",borderColor:"primary600",borderWidth:"1px",display:"block",hasRadius:!0,padding:6,shadow:"tableShadow"})}function te({id:t,index:o,canDelete:r,canReorder:f,isOpen:i=!1,stagesCount:l}){const n=s=>`${s+1} of ${l}`,u=s=>{D(p({id:"dnd.grab-item",defaultMessage:"{item}, grabbed. Current position in list: {position}. Press up and down arrow to change position, Spacebar to drop, Escape to cancel."},{item:h.value,position:n(s)}))},b=s=>{D(p({id:"dnd.drop-item",defaultMessage:"{item}, dropped. Final position in list: {position}."},{item:h.value,position:n(s)}))},H=()=>{D(p({id:"dnd.cancel-item",defaultMessage:"{item}, dropped. Re-order cancelled."},{item:h.value}))},W=(s,B)=>{D(p({id:"dnd.reorder",defaultMessage:"{item}, moved. New position in list: {position}."},{item:h.value,position:n(s)})),R(pe(B,s))},[F,D]=e.useState(null),{formatMessage:p}=(0,U.Z)(),{trackUsage:L}=(0,k.rS)(),R=(0,$.I0)(),[I,K]=e.useState(i),[h,Q]=(0,T.U$)(`stages.${o}.name`),[M,P]=(0,T.U$)(`stages.${o}.color`),[{handlerId:x,isDragging:O,handleKeyDown:Z},ze,He,Ke,re]=(0,Ie.Y9)(f,{index:o,item:{name:h.value},onGrabItem:u,onDropItem:b,onMoveItem:W,onCancel:H,type:c.uL.STAGE}),Qe=(0,Ze.FE)(ze,He),Xe=Te.map(({hex:s,name:B})=>({value:s,label:p({id:"Settings.review-workflows.stage.color.name",defaultMessage:"{name}"},{name:B}),color:s}));e.useEffect(()=>{re((0,Re.rX)(),{captureDraggingState:!1})},[re,o]);const{themeColorName:Ye}=M.value?(0,V.k)(M.value):{};return e.createElement(C.x,{ref:Qe},F&&e.createElement(ke.T,{"aria-live":"assertive"},F),O?e.createElement($e,null):e.createElement(Ee.U,{size:"S",variant:"primary",onToggle:()=>{K(!I),I||L("willEditStage")},expanded:I,shadow:"tableShadow"},e.createElement(xe.B,{title:h.value,togglePosition:"left",action:e.createElement(E.k,null,r&&e.createElement(q.h,{background:"transparent",icon:e.createElement(We.Z,null),label:p({id:"Settings.review-workflows.stage.delete",defaultMessage:"Delete stage"}),noBorder:!0,onClick:()=>R(me(t))}),e.createElement(q.h,{background:"transparent",forwardedAs:"div",role:"button",noBorder:!0,tabIndex:0,"data-handler-id":x,ref:Ke,label:p({id:"Settings.review-workflows.stage.drag",defaultMessage:"Drag"}),onClick:s=>s.stopPropagation(),onKeyDown:Z},e.createElement(De.Z,null)))}),e.createElement(Me.v,{padding:6,background:"neutral0",hasRadius:!0},e.createElement(be.r,{gap:4},e.createElement(_.P,{col:6},e.createElement(Ce.o,{...h,id:h.name,label:p({id:"Settings.review-workflows.stage.name.label",defaultMessage:"Stage name"}),error:Q.error??!1,onChange:s=>{h.onChange(s),R(X(t,{name:s.target.value}))},required:!0})),e.createElement(_.P,{col:6},e.createElement(ee.q4,{error:P?.error??!1,id:M.name,required:!0,label:p({id:"content-manager.reviewWorkflows.stage.color",defaultMessage:"Color"}),onChange:s=>{M.onChange({target:{value:s}}),R(X(t,{color:s}))},value:M.value.toUpperCase(),startIcon:e.createElement(E.k,{as:"span",height:2,background:M.value,borderColor:Ye==="neutral0"?"neutral150":"transparent",hasRadius:!0,shrink:0,width:2})},Xe.map(({value:s,label:B,color:ne})=>{const{themeColorName:Je}=(0,V.k)(ne);return e.createElement(ee.ag,{value:s,key:s,startIcon:e.createElement(E.k,{as:"span",height:2,background:ne,borderColor:Je==="neutral0"?"neutral150":"transparent",hasRadius:!0,shrink:0,width:2})},B)})))))))}te.propTypes=m().shape({id:m().number.isRequired,color:m().string.isRequired,canDelete:m().bool.isRequired,canReorder:m().bool.isRequired,stagesCount:m().number.isRequired}).isRequired;const Ae=(0,A.ZP)(C.x)`
  position: relative;
`,je=(0,A.ZP)(C.x)`
  left: 50%;
  position: absolute;
  top: 0;
  transform: translateX(-50%);
`;function z({stages:t}){const{formatMessage:o}=(0,U.Z)(),r=(0,$.I0)(),{trackUsage:f}=(0,k.rS)();return e.createElement(E.k,{direction:"column",gap:6,width:"100%"},e.createElement(Ae,{spacing:4,width:"100%"},e.createElement(je,{background:"neutral200",height:"100%",width:2,zIndex:1}),e.createElement(E.k,{direction:"column",alignItems:"stretch",gap:6,zIndex:2,position:"relative",as:"ol"},t.map((i,l)=>{const n=i?.id??i.__temp_key__;return e.createElement(C.x,{key:`stage-${n}`,as:"li"},e.createElement(te,{id:n,index:l,canDelete:t.length>1,isOpen:!i.id,canReorder:t.length>1,stagesCount:t.length}))}))),e.createElement(E.k,{direction:"column",gap:6},e.createElement(J,{type:"button",onClick:()=>{r(fe({name:""})),f("willCreateStage")}},o({id:"Settings.review-workflows.stage.add",defaultMessage:"Add new stage"}))))}z.defaultProps={stages:[]},z.propTypes={stages:m().arrayOf(m().shape({id:m().number,__temp_key__:m().number,name:m().string.isRequired}))};var Le=a(53752),ae=a(18172),Pe=a(18446),Oe=a.n(Pe);const oe={status:"loading",serverState:{currentWorkflow:null,workflows:[]},clientState:{currentWorkflow:{data:null,isDirty:!1,hasDeletedServerStages:!1}}};function Be(t=oe,o){return(0,ae.Uy)(t,r=>{const{payload:f}=o;switch(o.type){case c.QM:{const{status:i,workflows:l}=f;if(r.status=i,l?.length>0){let n=l[0];n={...n,stages:n.stages.map(u=>({...u,color:u?.color??c.FT}))},r.serverState.workflows=l,r.serverState.currentWorkflow=n,r.clientState.currentWorkflow.data=n,r.clientState.currentWorkflow.hasDeletedServerStages=!1}break}case c.x4:{const{stageId:i}=f,{currentWorkflow:l}=t.clientState;r.clientState.currentWorkflow.data.stages=l.data.stages.filter(n=>(n?.id??n.__temp_key__)!==i),l.hasDeletedServerStages||(r.clientState.currentWorkflow.hasDeletedServerStages=!!t.serverState.currentWorkflow.stages.find(n=>n.id===i));break}case c.Ot:{const{currentWorkflow:i}=t.clientState;i.data||(r.clientState.currentWorkflow.data={stages:[]});const l=Ne(r.clientState.currentWorkflow.data.stages);r.clientState.currentWorkflow.data.stages.push({...f,color:f?.color??c.FT,__temp_key__:l});break}case c.Nj:{const{currentWorkflow:i}=t.clientState,{stageId:l,...n}=f;r.clientState.currentWorkflow.data.stages=i.data.stages.map(u=>(u.id??u.__temp_key__)===l?{...u,...n}:u);break}case c.$k:{const{currentWorkflow:{data:{stages:i}}}=t.clientState,{newIndex:l,oldIndex:n}=f;if(l>=0&&l<i.length){const u=i[n];let b=[...i];b.splice(n,1),b.splice(l,0,u),r.clientState.currentWorkflow.data.stages=b}break}default:break}t.clientState.currentWorkflow.data&&(r.clientState.currentWorkflow.isDirty=!Oe()((0,ae.Vk)(r.clientState.currentWorkflow).data,r.serverState.currentWorkflow))})}const Ne=(t=[])=>{const o=t.map(r=>r.id??r.__temp_key__);return Math.max(...o,-1)+1};var j=a(87561);function Fe({formatMessage:t}){return j.Ry({stages:j.IX().of(j.Ry().shape({name:j.Z_().required(t({id:"Settings.review-workflows.validation.stage.name",defaultMessage:"Name is required"})).max(255,t({id:"Settings.review-workflows.validation.stage.max-length",defaultMessage:"Name can not be longer than 255 characters"})),color:j.Z_().required(t({id:"Settings.review-workflows.validation.stage.color",defaultMessage:"Color is required"})).matches(/^#(?:[0-9a-fA-F]{3}){1,2}$/i)}))})}function Ue({type:t,item:o}){switch(t){case c.uL.STAGE:return e.createElement(Y,{...o});default:return null}}function Ge(){const{trackUsage:t}=(0,k.rS)(),{formatMessage:o}=(0,U.Z)(),r=(0,$.I0)(),{put:f}=(0,k.kY)(),{formatAPIError:i}=(0,k.So)(),l=(0,k.lm)(),{workflows:n,status:u,refetch:b}=(0,Le.n)(),{status:H,clientState:{currentWorkflow:{data:W,isDirty:F,hasDeletedServerStages:D}}}=(0,$.v9)(x=>x?.[c.sN]??oe),[p,L]=(0,e.useState)(!1),{mutateAsync:R,isLoading:I}=(0,ce.useMutation)(async({workflowId:x,stages:O})=>{const{data:{data:Z}}=await f(`/admin/review-workflows/workflows/${x}/stages`,{data:O});return Z},{onSuccess(){l({type:"success",message:{id:"notification.success.saved",defaultMessage:"Saved"}})}}),K=async(x,O)=>{try{return await R({workflowId:x,stages:O})}catch(Z){return l({type:"warning",message:i(Z)}),null}},h=async()=>{await K(W.id,W.stages),await b(),L(!1)},Q=async()=>{await h()},M=()=>{L(x=>!x)},P=(0,T.TA)({enableReinitialize:!0,initialValues:W,async onSubmit(){D?L(!0):h()},validationSchema:Fe({formatMessage:o}),validateOnChange:!1});return ue(c.sN,Be),(0,e.useEffect)(()=>{r(ge({status:u,data:n}))},[u,n,r]),(0,e.useEffect)(()=>{t("didViewWorkflow")},[]),e.createElement(g.A,null,e.createElement(k.SL,{name:o({id:"Settings.review-workflows.page.title",defaultMessage:"Review Workflows"})}),e.createElement(d.o,{tabIndex:-1},e.createElement(de.r,{renderItem:Ue}),e.createElement(T.Hy,{value:P},e.createElement(T.l0,{onSubmit:P.handleSubmit},e.createElement(y.T,{primaryAction:e.createElement(S.z,{startIcon:e.createElement(ie.Z,null),type:"submit",size:"M",disabled:!F,loading:!p&&I},o({id:"global.save",defaultMessage:"Save"})),title:o({id:"Settings.review-workflows.page.title",defaultMessage:"Review Workflows"}),subtitle:o({id:"Settings.review-workflows.page.subtitle",defaultMessage:"{count, plural, one {# stage} other {# stages}}"},{count:W?.stages?.length??0})}),e.createElement(se.D,null,H==="loading"&&e.createElement(le.a,null,o({id:"Settings.review-workflows.page.isLoading",defaultMessage:"Workflow is loading"})),e.createElement(z,{stages:P.values?.stages})))),e.createElement(k.QH,{bodyText:{id:"Settings.review-workflows.page.delete.confirm.body",defaultMessage:"All entries assigned to deleted stages will be moved to the previous stage. Are you sure you want to save?"},isConfirmButtonLoading:I,isOpen:p,onToggleDialog:M,onConfirm:Q})))}const Ve=Ge},51584:(v,w,a)=>{var e=a(44239),g=a(37005),d="[object Boolean]";function y(S){return S===!0||S===!1||g(S)&&e(S)==d}v.exports=y},7654:(v,w,a)=>{var e=a(81763);function g(d){return e(d)&&d!=+d}v.exports=g},81763:(v,w,a)=>{var e=a(44239),g=a(37005),d="[object Number]";function y(S){return typeof S=="number"||g(S)&&e(S)==d}v.exports=y},7334:(v,w,a)=>{var e=a(79833);function g(d){return e(d).toLowerCase()}v.exports=g},12814:(v,w,a)=>{"use strict";a.d(w,{Z:()=>d});var e=a(85893);const g=y=>(0,e.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1rem",height:"1rem",fill:"none",viewBox:"0 0 24 24",...y,children:[(0,e.jsx)("path",{fill:"#212134",d:"M16.563 5.587a2.503 2.503 0 1 0 0-5.007 2.503 2.503 0 0 0 0 5.007Z"}),(0,e.jsx)("path",{fill:"#212134",d:"M18.487 3.083c-.012.788-.487 1.513-1.229 1.797a1.954 1.954 0 0 1-2.184-.574A1.943 1.943 0 0 1 14.9 2.11c.4-.684 1.2-1.066 1.981-.927a1.954 1.954 0 0 1 1.606 1.9c.011.748 1.17.748 1.158 0A3.138 3.138 0 0 0 17.565.17c-1.176-.423-2.567-.03-3.36.933-.83 1.002-.968 2.45-.284 3.575.678 1.124 1.993 1.674 3.273 1.431 1.432-.272 2.428-1.593 2.451-3.019.012-.753-1.147-.753-1.158-.006ZM16.563 14.372a2.503 2.503 0 1 0 0-5.007 2.503 2.503 0 0 0 0 5.007Z"}),(0,e.jsx)("path",{fill:"#212134",d:"M18.487 11.867c-.012.789-.487 1.513-1.229 1.797a1.954 1.954 0 0 1-2.184-.574 1.943 1.943 0 0 1-.174-2.196c.4-.684 1.2-1.066 1.981-.927.928.156 1.588.968 1.606 1.9.011.748 1.17.748 1.158 0a3.138 3.138 0 0 0-2.08-2.914c-1.176-.423-2.567-.029-3.36.933-.83 1.002-.968 2.45-.284 3.575.678 1.124 1.993 1.675 3.273 1.431 1.432-.272 2.428-1.593 2.451-3.019.012-.753-1.147-.753-1.158-.005ZM16.563 23.392a2.503 2.503 0 1 0 0-5.006 2.503 2.503 0 0 0 0 5.006Z"}),(0,e.jsx)("path",{fill:"#212134",d:"M18.487 20.89c-.012.787-.487 1.512-1.229 1.796a1.954 1.954 0 0 1-2.184-.574 1.943 1.943 0 0 1-.174-2.196c.4-.684 1.2-1.066 1.981-.927.928.156 1.588.967 1.606 1.9.011.748 1.17.748 1.158 0a3.138 3.138 0 0 0-2.08-2.914c-1.176-.423-2.567-.03-3.36.933-.83 1.002-.968 2.45-.284 3.575.678 1.124 1.993 1.674 3.273 1.431 1.432-.272 2.428-1.593 2.451-3.019.012-.753-1.147-.753-1.158-.006ZM7.378 5.622a2.503 2.503 0 1 0 0-5.007 2.503 2.503 0 0 0 0 5.007Z"}),(0,e.jsx)("path",{fill:"#212134",d:"M9.302 3.119c-.011.788-.486 1.512-1.228 1.796a1.954 1.954 0 0 1-2.185-.574 1.943 1.943 0 0 1-.173-2.196c.4-.684 1.199-1.066 1.981-.927a1.943 1.943 0 0 1 1.605 1.9c.012.748 1.17.748 1.16 0A3.138 3.138 0 0 0 8.38.205c-1.176-.423-2.567-.029-3.36.933-.83 1.002-.968 2.45-.285 3.575.678 1.124 1.994 1.675 3.274 1.431 1.431-.272 2.428-1.593 2.451-3.019.012-.753-1.147-.753-1.159-.005ZM7.378 14.406a2.503 2.503 0 1 0 0-5.006 2.503 2.503 0 0 0 0 5.006Z"}),(0,e.jsx)("path",{fill:"#212134",d:"M9.302 11.902c-.011.788-.486 1.513-1.228 1.797a1.954 1.954 0 0 1-2.185-.574 1.943 1.943 0 0 1-.173-2.196c.4-.684 1.199-1.066 1.981-.927a1.943 1.943 0 0 1 1.605 1.9c.012.748 1.17.748 1.16 0A3.138 3.138 0 0 0 8.38 8.988c-1.176-.423-2.567-.03-3.36.933-.83 1.002-.968 2.45-.285 3.575.678 1.124 1.994 1.674 3.274 1.431 1.431-.272 2.428-1.593 2.451-3.019.012-.753-1.147-.753-1.159-.006ZM7.378 23.427a2.503 2.503 0 1 0 0-5.007 2.503 2.503 0 0 0 0 5.007Z"}),(0,e.jsx)("path",{fill:"#212134",d:"M9.302 20.924c-.011.788-.486 1.513-1.228 1.797a1.954 1.954 0 0 1-2.185-.574 1.943 1.943 0 0 1-.173-2.196c.4-.684 1.199-1.066 1.981-.927.933.156 1.594.967 1.605 1.9.012.748 1.17.748 1.16 0A3.139 3.139 0 0 0 8.38 18.01c-1.176-.423-2.567-.03-3.36.933-.83 1.002-.968 2.45-.285 3.569.678 1.124 1.994 1.675 3.274 1.431 1.431-.272 2.428-1.593 2.451-3.019.012-.747-1.147-.747-1.159 0Z"})]}),d=g},99782:(v,w,a)=>{"use strict";a.d(w,{Z:()=>d});var e=a(85893);const g=y=>(0,e.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1rem",height:"1rem",fill:"none",viewBox:"0 0 24 24",...y,children:[(0,e.jsx)("circle",{cx:12,cy:12,r:12,fill:"#212134"}),(0,e.jsx)("path",{fill:"#F6F6F9",d:"M17 12.569c0 .124-.1.224-.225.224h-3.981v3.982c0 .124-.101.225-.226.225h-1.136a.225.225 0 0 1-.226-.225v-3.981H7.226A.225.225 0 0 1 7 12.567v-1.136c0-.125.1-.226.225-.226h3.982V7.226c0-.124.1-.225.224-.225h1.138c.124 0 .224.1.224.225v3.982h3.982c.124 0 .225.1.225.224v1.138Z"})]}),d=g}}]);
